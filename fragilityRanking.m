%% Stupid initial stuff

clear; close all

%% General input

criteriaNames = {'GeoArea', 'StatRef', 'ModelQuality', 'UserReqs'};

% all criteria are benefits (higher value indicates better performance)
typeCriteria = ones(1,numel(criteriaNames)); 

modelNamesEQ = {'Akkar', 'Eberik', 'Crowley', 'HAZUS',	'Gautam', 'Gentile'};
modelNamesFL = {'JRC', 'HAZUS', 'Tang'};

modelScoresEQ = [  1 2 2 2
                   1 2 2 2
                   1 2 2 2
                   1 1 2 2
                   3 2 2 2
                   2 3 3 3];

modelScoresFL = [  2 2 2 1
                   1 2 2 1
                   1 2 1 1];
               
%% Weights (uncomment where appropriate)

% % run your own AHP
% [weights, consistent, CR] = AHP(rankingCriteria);

% use weights defined in the paper
pairWise = [    1.0000    2.0000    0.5000    1.0000
                0.5000    1.0000    0.3333    1.0000
                2.0000    3.0000    1.0000    2.0000
                1.0000    1.0000    0.5000    1.0000];
[weights, consistent, CR] = AHP(criteriaNames, pairWise);

%% TOPSIS

rankingTableEQ = TOPSIS(...
    modelScoresEQ, weights, typeCriteria, modelNamesEQ, criteriaNames, 'spider');
rankingTableFL = TOPSIS(...
    modelScoresFL, weights, typeCriteria, modelNamesFL, criteriaNames, 'none');

%% Plots

x = 1:numel(criteriaNames);

figure('Position', [280   527   560   420]); hold on
bar(x,avgWeights)                
er = errorbar(x,avgWeights,stdWeights);    
scatter(x,groupWeights, 50, 'r', 'filled')
scatter(x,groupWeights2, 50, 'b', 'filled')

legend('Mean', 'Std', 'Group weight')
er.Color = [0 0 0];                            
er.LineStyle = 'none';
xticks(x)
xticklabels(criteriaNames)
ylabel('Weight [-]')
set(gca, 'XTickLabelRotation', 45)
set(gca, 'FontSize', 18)


figure('Position', [841   527   560   420]);
pie([sum(consistent==0) Nparticipants-sum(consistent==0)], ...
    {'AHP consistent', 'AHP inconsistent'})
set(findobj(gca,'type','text'),'FontSize',18)


figure('Position', [280    27   560   420]); hold on
for w = 1 : numel(criteriaNames)
    histogram(weights(:,w))
end
legend(criteriaNames)
xlabel('Weight [-]')
ylabel('Count')
set(gca, 'FontSize', 18)


figure('Position', [841    27   560   420]); hold on
for w = 1 : numel(criteriaNames)
    histogram(closeness(:,w))
end
set(gca, 'XLim', [0 1])
legend(modelNamesEQ, 'Location', 'NorthWest')
xlabel('Closeness to ideal solution [-]')
ylabel('Count')
set(gca, 'FontSize', 18)
annotation(gcf,'textbox',...
    [0.146428571428571 0.569047619047619 0.266071428571429 0.114285714285715],...
    'String',{'Group optimum:', modelNamesEQ{groupOptimum}},...
    'FontSize',18,...
    'FontName','Helvetica Neue',...
    'FitBoxToText','off');

% figure('Position', [841    27   560   420]); hold on
% boxplot(weights./mean(weights))
% xticklabels(impactMetrics)
% ylabel('Weight/Mean weight [-]')
% set(gca, 'XTickLabelRotation', 45)
% set(gca, 'FontSize', 18)